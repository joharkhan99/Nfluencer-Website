import*as e from"react";import t from"primereact/api";import{useResizeListener as r,useOverlayScrollListener as n,useMountEffect as o,useUpdateEffect as u,useUnmountEffect as i}from"primereact/hooks";import{Portal as a}from"primereact/portal";import{DomHandler as l,ZIndexUtils as c,ObjectUtils as s,classNames as f,mergeProps as p}from"primereact/utils";import{ComponentBase as d}from"primereact/componentbase";function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function v(e,t){if("object"!==m(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function h(e){var t=v(e,"string");return"symbol"===m(t)?t:String(t)}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g(e){if(Array.isArray(e))return y(e)}function b(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function E(e,t){if(e){if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e){if(Array.isArray(e))return e}function x(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,u,i,a=[],l=!0,c=!1;try{if(u=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=u.call(r)).done)&&(a.push(n.value),a.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}function S(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(e,t){return T(e)||x(e,t)||E(e,t)||S()}var A=d.extend({defaultProps:{__TYPE:"Tooltip",appendTo:null,at:null,autoHide:!0,autoZIndex:!0,baseZIndex:0,className:null,content:null,disabled:!1,event:null,hideDelay:0,hideEvent:"mouseleave",id:null,mouseTrack:!1,mouseTrackLeft:5,mouseTrackTop:5,my:null,onBeforeHide:null,onBeforeShow:null,onHide:null,onShow:null,position:"right",showDelay:0,showEvent:"mouseenter",showOnDisabled:!1,style:null,target:null,updateDelay:0,children:void 0}}),O=e.memo(e.forwardRef((function(d,m){var v=A.getProps(d),y=k(e.useState(!1),2),T=y[0],x=y[1],S=k(e.useState(v.position),2),O=S[0],C=S[1],I=k(e.useState(""),2),D=I[0],N=I[1],j=A.setMetaData({props:v,state:{visible:T,position:O,className:D}}).ptm,H=e.useRef(null),L=e.useRef(null),R=e.useRef(null),P=e.useRef(null),W=e.useRef(!0),B=e.useRef({}),M=e.useRef(null),Z=k(r({listener:function(e){!l.isTouchDevice()&&ne(e)}}),2),F=Z[0],Y=Z[1],_=k(n({target:R.current,listener:function(e){ne(e)},when:T}),2),z=_[0],U=_[1],X=function(e){return J(e,"mousetrack")||v.mouseTrack},$=function(e){return"true"===J(e,"disabled")||K(e,"disabled")||v.disabled},q=function(e){return J(e,"showondisabled")||v.showOnDisabled},G=function(){return J(R.current,"autohide")||v.autoHide},J=function(e,t){return K(e,"data-pr-".concat(t))?e.getAttribute("data-pr-".concat(t)):null},K=function(e,t){return e&&e.hasAttribute(t)},Q=function(e){var t=[J(e,"showevent")||v.showEvent],r=[J(e,"hideevent")||v.hideEvent];if(X(e))t=["mousemove"],r=["mouseleave"];else{var n=J(e,"event")||v.event;"focus"===n&&(t=["focus"],r=["blur"]),"both"===n&&(t=["focus","mouseenter"],r=["blur","mouseleave"])}return{showEvents:t,hideEvents:r}},V=function(e){return{top:J(e,"mousetracktop")||v.mouseTrackTop,left:J(e,"mousetrackleft")||v.mouseTrackLeft}},ee=function(e,t){if(L.current){var r=J(e,"tooltip")||v.content;r?(L.current.innerHTML="",L.current.appendChild(document.createTextNode(r)),t()):v.children&&t()}},te=function(e){ee(R.current,(function(){var r=M.current,n=r.pageX,o=r.pageY;v.autoZIndex&&!c.get(H.current)&&c.set("tooltip",H.current,t.autoZIndex,v.baseZIndex||t.zIndex.tooltip),H.current.style.left="",H.current.style.top="",G()&&(H.current.style.pointerEvents="none"),!X(R.current)&&"mouse"!=e||P.current||(P.current={width:l.getOuterWidth(H.current),height:l.getOuterHeight(H.current)}),oe(R.current,{x:n,y:o},e)}))},re=function(e){R.current=e.currentTarget;var t,r=$(R.current);(t=q(R.current)&&r?R.current.firstChild:R.current,!(v.content||J(t,"tooltip")||v.children))||r||(M.current=e,T?ce("updateDelay",te):se(v.onBeforeShow,{originalEvent:e,target:R.current})&&ce("showDelay",(function(){x(!0),se(v.onShow,{originalEvent:e,target:R.current})})))},ne=function(e){(fe(),T)&&(se(v.onBeforeHide,{originalEvent:e,target:R.current})&&ce("hideDelay",(function(){(G()||!1!==W.current)&&(c.clear(H.current),l.removeClass(H.current,"p-tooltip-active"),x(!1),se(v.onHide,{originalEvent:e,target:R.current}))})))},oe=function(e,t,r){var n=0,o=0,u=r||O;if((X(e)||"mouse"==u)&&t){var i={width:l.getOuterWidth(H.current),height:l.getOuterHeight(H.current)};n=t.x,o=t.y;var a=V(e),c=a.top,s=a.left;switch(u){case"left":n-=i.width+s,o-=i.height/2-c;break;case"right":case"mouse":n+=s,o-=i.height/2-c;break;case"top":n-=i.width/2-s,o-=i.height+c;break;case"bottom":n-=i.width/2-s,o+=c}n<=0||P.current.width>i.width?(H.current.style.left="0px",H.current.style.right=window.innerWidth-i.width-n+"px"):(H.current.style.right="",H.current.style.left=n+"px"),H.current.style.top=o+"px",l.addClass(H.current,"p-tooltip-active")}else{var f=l.findCollisionPosition(u),p=J(e,"my")||v.my||f.my,d=J(e,"at")||v.at||f.at;H.current.style.padding="0px",l.flipfitCollision(H.current,e,p,d,(function(e){var t=e.at,r=t.x,n=v.at?"center"!==r&&r!==e.my.x?r:t.y:e.at["".concat(f.axis)];H.current.style.padding="",C(n),ue(n),l.addClass(H.current,"p-tooltip-active")}))}},ue=function(e){if(H.current){var t=getComputedStyle(H.current);"left"===e?H.current.style.left=parseFloat(t.left)-2*parseFloat(t.paddingLeft)+"px":"top"===e&&(H.current.style.top=parseFloat(t.top)-2*parseFloat(t.paddingTop)+"px")}},ie=function(e){G()||(W.current=!0,ne(e))},ae=function(e){if(e){var t=Q(e),r=t.showEvents,n=t.hideEvents,o=pe(e);r.forEach((function(e){return null==o?void 0:o.addEventListener(e,re)})),n.forEach((function(e){return null==o?void 0:o.addEventListener(e,ne)}))}},le=function(e){if(e){var t=Q(e),r=t.showEvents,n=t.hideEvents,o=pe(e);r.forEach((function(e){return null==o?void 0:o.removeEventListener(e,re)})),n.forEach((function(e){return null==o?void 0:o.removeEventListener(e,ne)}))}},ce=function(e,t){fe();var r=J(R.current,e.toLowerCase())||v[e];r?B.current["".concat(e)]=setTimeout((function(){return t()}),r):t()},se=function(e){if(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=e.apply(void 0,r);return void 0===o&&(o=!0),o}return!0},fe=function(){Object.values(B.current).forEach((function(e){return clearTimeout(e)}))},pe=function(e){if(e){if(q(e)){if(e.hasWrapper)return e.parentElement;var t=document.createElement("span");return l.addClass(t,"p-tooltip-target-wrapper"),e.parentNode.insertBefore(t,e),t.appendChild(e),e.hasWrapper=!0,t}var r;return e.hasWrapper&&((r=e.parentElement).replaceWith.apply(r,g(n=e.parentElement.childNodes)||b(n)||E(n)||w()),delete e.hasWrapper),e}var n;return null},de=function(e){ve(e),me(e)},me=function(e){he(e||v.target,ae)},ve=function(e){he(e||v.target,le)},he=function(e,t){if(e=s.getRefElement(e))if(l.isElement(e))t(e);else{var r=function(e){l.find(document,e).forEach((function(e){t(e)}))};e instanceof Array?e.forEach((function(e){r(e)})):r(e)}};o((function(){me(),T&&R.current&&$(R.current)&&ne()})),u((function(){return me(),function(){ve()}}),[re,ne,v.target]),u((function(){if(T){var e=J(R.current,"position")||O,t=J(R.current,"classname");C(e),N(t),te(e),F(),z()}else C(v.position),N(""),R.current=null,P.current=null,W.current=!0;return function(){Y(),U()}}),[T]),u((function(){T&&ce("updateDelay",(function(){ee(R.current,(function(){oe(R.current)}))}))}),[v.content]),i((function(){fe(),ve(),c.clear(H.current)})),e.useImperativeHandle(m,(function(){return{props:v,updateTargetEvents:de,loadTargetEvents:me,unloadTargetEvents:ve,show:re,hide:ne,getElement:function(){return H.current},getTarget:function(){return R.current}}}));var ye,ge,be,Ee,we,Te,xe,Se,ke;if(T){var Ae=(we=f("p-tooltip p-component",(ye={},ge="p-tooltip-".concat(O),be=!0,(ge=h(ge))in ye?Object.defineProperty(ye,ge,{value:be,enumerable:!0,configurable:!0,writable:!0}):ye[ge]=be,ye),v.className,D),Ee=R.current,Te=!(v.content||J(Ee,"tooltip")),xe=p({id:v.id,ref:H,className:we,style:v.style,role:"tooltip","aria-hidden":T,onMouseEnter:function(e){G()||(W.current=!1)},onMouseLeave:function(e){return ie}},A.getOtherProps(v),j("root")),Se=p({className:"p-tooltip-arrow"},j("arrow")),ke=p({ref:L,className:"p-tooltip-text"},j("text")),e.createElement("div",xe,e.createElement("div",Se),e.createElement("div",ke,Te&&v.children)));return e.createElement(a,{element:Ae,appendTo:v.appendTo,visible:!0})}return null})));O.displayName="Tooltip";export{O as Tooltip};
